const fs = require('fs');
const simpleGit = require('simple-git');

const git = simpleGit();

async function generateGitInfo() {
    const gitLog = await git.log();
    const branch = await git.revparse(['--abbrev-ref', 'HEAD']);
    const shortHash = await git.revparse(['--short', 'HEAD']);
    const envContent = `
# THIS FILE IN AUTOGENERATED (use .env.local or .env.production instead)

VITE_BRANCH_NAME=${branch.trim()}
VITE_COMMIT_HASH=${shortHash.trim()}
VITE_COMMIT_DATE=${gitLog.latest.date}
`;
    fs.writeFileSync('.env', envContent);
}

generateGitInfo().catch(err => {
    console.error('Failed to generateGitInfo:', err);
    process.exit(1);
});
